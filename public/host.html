<!DOCTYPE html>
<html>
<head>
    <title>Vet-Quiz Host</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-purple-900 text-white font-sans overflow-hidden h-screen flex flex-col">

    <div id="lobby" class="flex flex-col items-center justify-center h-full text-center p-8">
        <h1 class="text-6xl font-bold mb-8">Ä°Ã§ HastalÄ±klarÄ± Quiz</h1>
        <div class="bg-white/10 p-8 rounded-xl w-full max-w-4xl backdrop-blur-sm">
            <h2 class="text-3xl mb-4">KatÄ±lanlar (<span id="player-count">0</span>)</h2>
            <div id="player-list" class="flex flex-wrap justify-center gap-3 min-h-[100px] max-h-[300px] overflow-y-auto p-4"></div>
        </div>
        <button onclick="startGame()" class="mt-12 bg-green-500 hover:bg-green-600 text-white px-16 py-6 rounded-full font-bold text-4xl shadow-2xl hover:scale-105 transition">BAÅLAT ğŸš€</button>
    </div>

    <div id="game-area" class="hidden h-full flex flex-col p-4 relative">
        <div class="flex justify-between items-center mb-4">
            <span id="q-counter" class="text-2xl font-bold">Soru 1/10</span>
            <div class="bg-purple-800 rounded-full w-24 h-24 flex items-center justify-center border-4 border-white">
                <span id="timer" class="text-5xl font-bold">10</span>
            </div>
        </div>
        <div class="flex-grow flex items-center justify-center mb-4">
            <h2 id="question-text" class="text-5xl font-bold text-center bg-white text-purple-900 p-12 rounded-2xl shadow-2xl w-full mx-8">Soru YÃ¼kleniyor...</h2>
        </div>
        
        <div id="stats-view" class="hidden absolute inset-0 bg-black/90 z-20 flex flex-col items-center justify-center">
            <h2 class="text-4xl font-bold mb-8 text-white">CEVAP DAÄILIMI</h2>
            <div id="graph-bars" class="flex items-end justify-center gap-16 h-96 w-full px-32"></div>
        </div>

        <div id="options-grid" class="grid grid-cols-2 gap-6 h-64 text-3xl font-bold">
            <div id="opt-0" class="bg-red-500 flex items-center p-6 rounded-xl text-white shadow-lg">A</div>
            <div id="opt-1" class="bg-blue-500 flex items-center p-6 rounded-xl text-white shadow-lg">B</div>
            <div id="opt-2" class="bg-yellow-500 flex items-center p-6 rounded-xl text-white shadow-lg">C</div>
            <div id="opt-3" class="bg-green-500 flex items-center p-6 rounded-xl text-white shadow-lg">D</div>
        </div>
    </div>

    <div id="leaderboard" class="hidden h-full flex flex-col items-center justify-center bg-blue-900">
        <h1 class="text-6xl font-bold mb-12 text-yellow-400">PUAN DURUMU</h1>
        <div id="score-list" class="w-2/3 space-y-4"></div>
    </div>

    <div id="final-screen" class="hidden h-full flex flex-col items-center justify-center bg-black">
        <h1 class="text-7xl font-bold text-yellow-400 mb-16">ğŸ† KAZANANLAR ğŸ†</h1>
        <div class="flex items-end justify-center gap-4 w-full px-12 h-1/2">
            <div class="flex flex-col items-center w-1/4"><span id="p2-name" class="text-2xl font-bold mb-2 text-white">Yok</span><div class="bg-gray-400 w-full h-48 flex items-center justify-center text-6xl font-black">2</div></div>
            <div class="flex flex-col items-center w-1/4"><span id="p1-name" class="text-3xl font-bold mb-2 text-yellow-300">Yok</span><div class="bg-yellow-500 w-full h-80 flex items-center justify-center text-8xl font-black">1</div></div>
            <div class="flex flex-col items-center w-1/4"><span id="p3-name" class="text-2xl font-bold mb-2 text-white">Yok</span><div class="bg-orange-700 w-full h-32 flex items-center justify-center text-6xl font-black">3</div></div>
        </div>
    </div>

    <script>
        const socket = io();

        socket.on('update-player-list', (players) => {
            document.getElementById('player-count').innerText = players.length;
            document.getElementById('player-list').innerHTML = players.map(p => `<span class="bg-purple-600 px-4 py-2 rounded-full text-lg shadow-md m-1">${p.nickname}</span>`).join('');
        });

        function startGame() { socket.emit('start-game'); }

        socket.on('new-question', (data) => {
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('leaderboard').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');
            document.getElementById('stats-view').classList.add('hidden');
            
            document.getElementById('question-text').innerText = data.text;
            document.getElementById('q-counter').innerText = `Soru ${data.qIndex} / ${data.total}`;
            document.getElementById('timer').innerText = data.time;

            const colors = ['bg-red-500', 'bg-blue-500', 'bg-yellow-500', 'bg-green-500'];
            data.options.forEach((opt, i) => {
                const el = document.getElementById(`opt-${i}`);
                el.innerText = opt;
                el.className = `${colors[i]} flex items-center p-6 rounded-xl text-white shadow-lg opacity-100`;
            });
        });

        socket.on('timer-tick', (t) => document.getElementById('timer').innerText = t);

        socket.on('show-graph', (data) => {
            const statsView = document.getElementById('stats-view');
            statsView.classList.remove('hidden');
            const bars = document.getElementById('graph-bars');
            bars.innerHTML = '';
            const maxVal = Math.max(...data.stats) || 1;
            const colors = ['bg-red-500', 'bg-blue-500', 'bg-yellow-500', 'bg-green-500'];

            data.stats.forEach((count, i) => {
                const h = (count / maxVal) * 100;
                const border = (i === data.correctIndex) ? 'border-4 border-white brightness-125' : 'opacity-60';
                bars.innerHTML += `<div class="flex flex-col items-center justify-end h-full w-32"><span class="text-3xl font-bold text-white mb-2">${count}</span><div class="${colors[i]} w-full rounded-t-lg transition-all ${border}" style="height: ${h}%"></div><span class="text-4xl mt-2 text-white">${i===data.correctIndex ? 'âœ…':''}</span></div>`;
            });
        });

        socket.on('show-leaderboard', (players) => {
            document.getElementById('game-area').classList.add('hidden');
            document.getElementById('leaderboard').classList.remove('hidden');
            document.getElementById('score-list').innerHTML = players.map((p, i) => `
                <div class="flex justify-between bg-blue-800 p-6 rounded-xl items-center shadow-lg w-full text-white">
                    <span class="text-4xl font-bold w-12 text-yellow-400">#${i+1}</span>
                    <span class="text-3xl">${p.nickname}</span>
                    <span class="text-3xl font-bold text-green-400">${Math.floor(p.score)} P</span>
                </div>
            `).join('');
        });

        socket.on('game-over', (players) => {
            document.getElementById('leaderboard').classList.add('hidden');
            document.getElementById('final-screen').classList.remove('hidden');
            if(players[0]) document.getElementById('p1-name').innerText = players[0].nickname;
            if(players[1]) document.getElementById('p2-name').innerText = players[1].nickname;
            if(players[2]) document.getElementById('p3-name').innerText = players[2].nickname;
        });
    </script>
</body>
</html>