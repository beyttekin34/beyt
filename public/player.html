<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Veteriner Klinik Arena</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .selected { outline: 6px solid white; transform: scale(1.05); z-index: 50; }
        .dimmed { opacity: 0.05; }
        .grid-item { min-height: 120px; }
        .gold-glow { border: 4px solid #eab308; box-shadow: 0 0 20px rgba(234, 179, 8, 0.6); }
    </style>
</head>
<body class="bg-slate-950 text-white font-sans min-h-screen overflow-y-auto pb-20">

    <div id="bar" class="hidden sticky top-0 bg-indigo-900 p-3 flex justify-between items-center shadow-2xl z-40">
        <div class="flex flex-col"><span id="p-name" class="font-black text-[10px] uppercase truncate max-w-[100px]"></span><span id="q-idx" class="text-[8px] opacity-60 font-bold">SORU: 0/0</span></div>
        <div class="bg-black/30 px-3 py-1 rounded-full font-black text-[10px] text-indigo-300">SÃœRE: <span id="p-timer">10</span></div>
    </div>

    <div id="login-screen" class="min-h-screen flex flex-col items-center justify-center p-8 space-y-6">
        <h1 class="text-4xl font-black text-indigo-400 text-center uppercase tracking-tighter italic leading-none">Veteriner<br>Klinik Arena</h1>
        <input type="text" id="nick" placeholder="AD SOYAD" class="w-full p-4 text-center bg-white/5 border-2 border-white/10 rounded-2xl outline-none focus:border-indigo-600 font-black uppercase text-lg">
        <button onclick="join()" class="w-full bg-indigo-700 py-4 rounded-2xl text-xl font-black shadow-2xl active:scale-95 transition-all">KATIL</button>
    </div>

    <div id="waiting-screen" class="hidden min-h-screen flex flex-col items-center justify-center p-10 text-center">
        <div class="animate-pulse space-y-4">
            <h2 class="text-3xl font-black text-indigo-400 uppercase">HAZIR OL</h2>
            <p class="text-xs opacity-50 font-bold italic">Vaka analizi baÅŸlatÄ±lmasÄ± bekleniyor...</p>
        </div>
    </div>

    <div id="game" class="hidden p-4 space-y-4 mt-4">
        <div class="bg-white/5 p-5 rounded-2xl border border-white/10 shadow-xl">
            <h2 id="q-text" class="text-base font-black text-center leading-relaxed"></h2>
        </div>
        <div class="grid grid-cols-2 gap-2">
            <button onclick="ans(0)" id="b-0" class="bg-rose-500 grid-item rounded-2xl font-black text-[10px] flex items-center justify-center p-3 relative shadow-lg"><span class="absolute top-2 left-3 bg-black/20 px-1.5 py-0.5 rounded text-[8px]">A</span><span class="t text-center"></span></button>
            <button onclick="ans(1)" id="b-1" class="bg-sky-500 grid-item rounded-2xl font-black text-[10px] flex items-center justify-center p-3 relative shadow-lg"><span class="absolute top-2 left-3 bg-black/20 px-1.5 py-0.5 rounded text-[8px]">B</span><span class="t text-center"></span></button>
            <button onclick="ans(2)" id="b-2" class="bg-amber-500 grid-item rounded-2xl font-black text-[10px] flex items-center justify-center p-3 relative shadow-lg"><span class="absolute top-2 left-3 bg-black/20 px-1.5 py-0.5 rounded text-[8px]">C</span><span class="t text-center"></span></button>
            <button onclick="ans(3)" id="b-3" class="bg-emerald-600 grid-item rounded-2xl font-black text-[10px] flex items-center justify-center p-3 relative shadow-lg"><span class="absolute top-2 left-3 bg-black/20 px-1.5 py-0.5 rounded text-[8px]">D</span><span class="t text-center"></span></button>
        </div>
    </div>

    <div id="stats" class="hidden p-6 flex flex-col min-h-screen">
        <h2 id="res" class="text-3xl font-black text-center mb-6 uppercase"></h2>
        <div class="bg-indigo-600/20 p-4 rounded-2xl mb-8 border-l-8 border-indigo-600">
            <p class="text-[8px] font-black text-indigo-400 uppercase mb-1">DoÄŸru YanÄ±t:</p>
            <p id="cor" class="text-xs font-black"></p>
        </div>
        <div id="graph" class="space-y-4"></div>
    </div>

    <div id="lb" class="hidden p-6 flex flex-col min-h-screen">
        <h2 id="lb-title" class="text-xl font-black text-center text-indigo-400 mb-8 uppercase tracking-widest italic">SÄ±ralama</h2>
        <div id="lb-list" class="space-y-2"></div>
    </div>

    <script>
        const socket = io(); let me = "";
        function join() { me = document.getElementById('nick').value.trim(); if(!me) return; socket.emit('player-join', me); document.getElementById('p-name').innerText = me; }
        socket.on('join-success', () => { show('waiting-screen'); document.getElementById('bar').classList.remove('hidden'); window.scrollTo(0,0); });
        
        socket.on('new-question', (d) => {
            show('game'); window.scrollTo(0,0);
            document.getElementById('q-idx').innerText = `SORU: ${d.qIndex}/${d.total}`; document.getElementById('q-text').innerText = d.text; document.getElementById('p-timer').innerText = d.time;
            for(let i=0; i<4; i++){ const b=document.getElementById(`b-${i}`); b.classList.remove('selected','dimmed'); b.querySelector('.t').innerText=d.options[i]; b.disabled = false; }
        });

        socket.on('timer-tick', (t) => document.getElementById('p-timer').innerText = t);
        function ans(i) { socket.emit('submit-answer', i); for(let j=0; j<4; j++){ const b=document.getElementById(`b-${j}`); b.disabled=true; if(i===j) b.classList.add('selected'); else b.classList.add('dimmed'); } }
        
        socket.on('question-result-data', (d) => {
            show('stats'); const myA = d.playersAnswers[socket.id];
            document.getElementById('res').innerText = (myA === d.correctIndex) ? "DOÄžRU âœ…" : "HATALI âŒ";
            document.getElementById('res').className = `text-3xl font-black text-center mb-6 ${myA === d.correctIndex ? 'text-emerald-400' : 'text-rose-500'}`;
            document.getElementById('cor').innerText = d.correctText;
            const g = document.getElementById('graph'); g.innerHTML = '';
            const max = Math.max(...d.stats) || 1;
            const colors = ['bg-rose-500','bg-sky-500','bg-amber-500','bg-emerald-600'];
            d.stats.forEach((c, i) => { const w = (c/max)*100; g.innerHTML += `<div class="flex items-center gap-2"><div class="text-[10px] w-3 font-black">${['A','B','C','D'][i]}</div><div class="flex-grow h-3 bg-white/10 rounded-full overflow-hidden"><div class="${colors[i]} h-full transition-all duration-1000" style="width:${w}%"></div></div><div class="text-[10px] w-3 text-right font-black">${c}</div></div>`; });
        });

        socket.on('show-leaderboard', (list) => { show('lb'); document.getElementById('lb-list').innerHTML = list.slice(0,5).map((p, i) => `<div class="flex justify-between items-center ${p.nickname === me ? 'bg-indigo-700 ring-2 ring-white' : 'bg-white/5'} p-3 rounded-xl"><span class="text-[10px] font-black uppercase">#${i+1} ${p.nickname}</span><span class="text-[10px] font-black text-emerald-400">${Math.floor(p.score)} P</span></div>`).join(''); });

        socket.on('game-over', (list) => {
            show('lb');
            document.getElementById('lb-title').innerText = "YARIÅžMA SONA ERDÄ°";
            confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
            const myF = list.find(p => p.nickname === me);
            if(myF) {
                let rank = list.findIndex(p => p.nickname === me) + 1;
                let rankClass = rank === 1 ? 'gold-glow bg-yellow-600/40' : 'bg-indigo-600';
                let rankText = rank === 1 ? 'ðŸ¥‡ ÅžAMPÄ°YON ðŸ¥‡' : `SIRALAMAN: #${rank}`;
                document.getElementById('lb-list').innerHTML = `<div class="${rankClass} p-6 rounded-3xl text-center mb-6 animate-bounce"><h3 class="text-xs font-black uppercase mb-2">${rankText}</h3><div class="text-5xl font-black">${Math.floor(myF.score)} P</div></div>` + document.getElementById('lb-list').innerHTML;
            }
        });

        function show(id) { ['login-screen','waiting-screen','game','stats','lb'].forEach(x => document.getElementById(x).classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
    </script>
</body>
</html>